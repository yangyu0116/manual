<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<link rel="stylesheet" href="Word2Chm.css" type="text/css">
</head>

<body lang=ZH-CN link=blue vlink=purple style='text-justify-trim:punctuation'>

<div class=WordSection1 style='layout-grid:15.6pt'>

<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:16.0pt;'>媒体播放</span></b></p>
<p class=MsoNormal align=center style='text-align:center'><span
>译者署名：</span><span style='font-family:"Calibri","sans-serif"'>
</span><span >呆呆大虾</span></p>
<p class=MsoNormal align=center style='text-align:center'><span
>译者微博：</span><span class=apple-style-span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#4B4B4B;background:
white'><a target="_blank" href="http://weibo.com/popapa">http://weibo.com/popapa</a> </span></span></p>
<p class=MsoNormal align=center style='text-align:center'><span
>版本：</span><span style='font-family:"Calibri","sans-serif"'>Android
4.0 r1</span></p>
<p class=MsoNormal align=left style='text-align:left'><b><span
style='font-size:12.0pt;'>原文</span></b></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
lang=EN-US style='font-family:"Calibri","sans-serif"'><a target="_blank" href="http://developer.android.com/guide/topics/media/mediaplayer.html">http://developer.android.com/guide/topics/media/mediaplayer.html</a>
</span></p>
<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>
<p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><b><span
style=';color:#7BB026'>在本文中</span></b></p>
<p class=MsoNormal align=left style='margin-left:21.0pt;text-align:left;
background:white'><u><span style='font-family:"Calibri","sans-serif";
color:#CC6600'><a href="#basic"><span style=';
color:#CC6600'><span>简介</span></span></a></span></u></p>
<p class=MsoNormal align=left style='margin-left:21.0pt;text-align:left;
background:white'><u><span style='font-family:"Calibri","sans-serif";
color:#CC6600'><a href="#manifest"><span style='color:#CC6600'>Manifest</span><span
lang=EN-US style=';color:#CC6600'><span>声明</span></span></a></span></u></p>
<p class=MsoNormal align=left style='margin-left:21.0pt;text-align:left;
background:white'><u><span style='font-family:"Calibri","sans-serif";
color:#CC6600'><a href="#mediaplayer"><span style='color:#CC6600'>MediaPlayer</span><span
lang=EN-US style=';color:#CC6600'><span>的使用</span></span></a></span></u></p>
<p class=MsoNormal align=left style='margin-left:21.0pt;text-align:left;
background:white'><span style='font-family:"Calibri","sans-serif";
color:#333333'><a href="1.htm#Async_Prep"><span style='font-family:
宋体;color:#CC6600'><span>异步准备</span></span></a></span></p>
<p class=MsoNormal align=left style='margin-left:21.0pt;text-align:left;
background:white'><u><span style='font-family:"Calibri","sans-serif";
color:#CC6600'><a href="1.htm#state"><span style=';
color:#CC6600'><span>状态管理</span></span></a></span></u></p>
<p class=MsoNormal align=left style='margin-left:21.0pt;text-align:left;
background:white'><u><span style='font-family:"Calibri","sans-serif";
color:#CC6600'><a href="1.htm#release"><span style='font-family:
宋体;color:#CC6600'><span>释放</span></span><span style='color:#CC6600'>MediaPlayer</span></a></span></u></p>
<p class=MsoNormal align=left style='margin-left:21.0pt;text-align:left;
background:white'><u><span style='font-family:"Calibri","sans-serif";
color:#CC6600'><a href="#service"><span style=';
color:#CC6600'><span>使<span>用</span></span></span><span
lang=EN-US style=';color:#CC6600'><span>带</span></span><span
style='color:#CC6600'>MediaPlayer</span><span style='font-family:
宋体;color:#CC6600'><span>的服务</span></span></a></span></u></p>
<p class=MsoNormal align=left style='margin-left:21.0pt;text-align:left;
background:white'><u><span style='font-family:"Calibri","sans-serif";
color:#CC6600'><a href="1.htm#Async_run"><span style='font-family:
宋体;color:#CC6600'><span>异步<span>运<span>行</span></span></span></span></a></span></u><span
class=Arial><span style='font-family:"Calibri","sans-serif"'> </span></span></p>
<p class=MsoNormal align=left style='margin-left:21.0pt;text-align:left;
background:white'><span style='font-family:"Calibri","sans-serif";
color:#333333'><a href="1.htm#Async_error"><span style='font-family:
宋体;color:#CC6600'><span>异步错<span>误</span></span></span><span
lang=EN-US style=';color:#CC6600'><span>的</span></span><span
lang=EN-US style=';color:#CC6600'><span>处理</span></span></a></span></p>
<p class=MsoNormal align=left style='margin-left:21.0pt;text-align:left;
background:white'><span style='font-family:"Calibri","sans-serif";
color:#333333'><a href="1.htm#wakelock"><span style='color:#CC6600'>Wake Lock</span><span
lang=EN-US style=';color:#CC6600'><span>的使用</span></span></a></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'> </span></span></p>
<p class=MsoNormal align=left style='margin-left:21.0pt;text-align:left;
background:white'><span style='font-family:"Calibri","sans-serif";
color:#333333'><a href="1.htm#run_as_service"><span
style=';color:#CC6600'><span>作为后台服务<span>运<span>行</span></span></span></span></a></span><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'> </span></span></p>
<p class=MsoNormal align=left style='margin-left:21.0pt;text-align:left;
background:white'><u><span style='font-family:"Calibri","sans-serif";
color:#CC6600'><a href="1.htm#audio_focus"><span style='color:#CC6600'>Audio Focus</span></a></span></u><u><span
style=';color:#CC6600'>的处理</span></u><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'> </span></span></p>
<p class=MsoNormal align=left style='margin-left:21.0pt;text-align:left;
background:white'><span style='font-family:"Calibri","sans-serif";
color:#333333'><a href="1.htm#cleanup"><span style='font-family:
宋体;color:#CC6600'><span>进行清理</span></span></a></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'> </span></span></p>
<p class=MsoNormal align=left style='margin-left:21.0pt;text-align:left;
background:white'><u><span style=';color:#CC6600'>对</span></u><u><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#CC6600'><a
href="#intent_noisy"><span style=';color:#CC6600'><span>意图</span></span><span style='color:#CC6600'>AUDIO_BECOMING_NOISY</span><span
lang=EN-US style=';color:#CC6600'><span>的处理</span></span></a></span></u></p>
<p class=MsoNormal align=left style='margin-left:21.0pt;text-align:left;
background:white'><span style='font-family:"Calibri","sans-serif";
color:#333333'><a href="#ContentResolver"><span style='font-family:
宋体;color:#CC6600'><span>从</span></span><span style='color:#CC6600'>Content
Resolver</span><span style=';color:#CC6600'><span>中读</span></span><span style=';color:#CC6600'><span>取媒体</span></span></a></span></p>
<p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><b><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#7BB026'>&nbsp;</span></b></p>
<p class=MsoNormal align=left style='text-align:left'><b><span
style=';color:#7BB026'>关键类</span></b></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
background:white'><span style='font-family:"Calibri","sans-serif";
color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#CC6600'>MediaPlayer</span></a></span><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'> </span></span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
background:white'><span style='font-family:"Calibri","sans-serif";
color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/AudioManager.html"><span
style='color:#CC6600'>AudioManager</span></a></span><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'> </span></span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
background:white'><span style='font-family:"Calibri","sans-serif";
color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/SoundPool.html"><span
style='color:#CC6600'>SoundPool</span></a></span><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'> </span></span></p>
<p class=MsoNormal align=left style='text-align:left'><b><span
style='font-family:"Calibri","sans-serif";color:#7BB026'>&nbsp;</span></b></p>
<p class=MsoNormal align=left style='text-align:left;layout-grid-mode:char'><b><span
style=';color:#7BB026'>参阅</span></b></p>
<p class=MsoNormal align=left style='margin-left:21.0pt;text-align:left;
background:white'><u><span style='font-family:"Calibri","sans-serif";
color:#CC6600'><a target="_blank" href="http://developer.android.com/guide/topics/media/jetplayer.html"><span
style='color:#CC6600'>JetPlayer</span></a></span></u></p>
<p class=MsoNormal align=left style='margin-left:21.0pt;text-align:left;
background:white'><u><span style='font-family:"Calibri","sans-serif";
color:#CC6600'><a target="_blank" href="http://developer.android.com/guide/topics/media/audio-capture.html"><span
lang=EN-US style=';color:#CC6600'><span>音频捕获</span></span></a></span></u></p>
<p class=MsoNormal align=left style='margin-left:21.0pt;text-align:left;
background:white'><span style='font-family:"Calibri","sans-serif";
color:#333333'><a target="_blank" href="http://developer.android.com/guide/appendix/media-formats.html"><span
style='color:#CC6600'>Android</span><span style=';
color:#CC6600'><span>支持的媒体格式</span></span></a></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'> </span></span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
background:white'><span style='font-family:"Calibri","sans-serif";
color:#333333'><a target="_blank" href="http://developer.android.com/guide/topics/data/data-storage.html"><span
lang=EN-US style=';color:#CC6600'><span>数据存储</span></span></a></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'> </span></span></p>
<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>Android</span></span><span
class=Arial><span >的多媒体框架支持多种通用媒体的播放，因此能够很容易地在程序中集成音频、视频和图片信息。利用</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'> API</span></span><span
class=Arial><span >，可以播放多种来源的音视频数据，包括存储于程序资源（裸资源）中的媒体文件、文件系统中的独立文件、通过网络连接读取的数据流。</span></span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
>本文演示了如何编写一个媒体播放程序。为了兼顾良好的性能和舒适的用户体验，它还实现了播放期间用户和系统之间的交互。</span></p>

<div style='border:none;border-left:solid #99AACC 3.0pt;padding:0cm 0cm 0cm 6.0pt;
margin-left:21.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
border:none;padding:0cm'><b><span style=';color:#333333'>注意：</span></b><span
class=Arial><span style='font-family:"Calibri","sans-serif"'> </span></span><span
class=Arial><span >只能在标准的输出设备上播放音频数据，目前即为移动设备的扬声器或蓝牙耳机。并且不能在通话期间同时播放音频文件。</span></span></p>

</div>

<p class=MsoNormal align=left style='text-align:left'><span
style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>
<p class=MsoNormal align=left style='text-align:left'><span
style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>
<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:12.0pt;'>简介</span></b></p>
<p class=MsoNormal align=left style='text-align:left'><span style='font-family:
宋体'>下列类用于在</span><span class=Arial><span style='font-family:"Calibri","sans-serif"'>Android</span></span><span
class=Arial><span >框架中播放音视频：</span></span></p>
<p class=MsoNormal style='margin-left:21.0pt;text-indent:-21.0pt'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span></p>
<p class=MsoNormal style='margin-left:21.0pt'><span >本类是播放音视频的主要</span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>API</span></span><span
>。</span></p>
<p class=MsoNormal style='margin-left:21.0pt;text-indent:-21.0pt'><u><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#006699'><a target="_blank" href="http://developer.android.com/reference/android/media/AudioManager.html"><span
style='color:#006699'>AudioManager</span></a></span></u></p>
<p class=MsoNormal style='margin-left:21.0pt'><span >本类管理音频源和设备的音频输出。</span></p>
<p class=MsoNormal align=left style='text-align:left'><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>&nbsp;</span></span></p>
<p class=MsoNormal align=left style='text-align:left'><span class=Arial><b><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>Manifest</span></b></span><span
class=Arial><b><span >声明</span></b></span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
class=Arial><span >在开始开发</span></span><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>MediaPlayer</span></span><span
class=Arial><span >的应用程序之前，请确保</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>manifest</span></span><span
class=Arial><span >已经正确地声明了以下相关</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>feature</span></span><span
class=Arial><span >：</span></span></p>
<p class=MsoNormal align=left style='margin-left:42.1pt;text-align:left;
text-indent:-21.1pt'><span style='font-size:10.0pt;font-family:Symbol;
color:#333333'>・<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b><span style='font-family:"Calibri","sans-serif";
color:#333333'>Internet Permission</span></b><span style='font-family:
"Calibri","sans-serif";color:#333333'> ―― </span><span >如果正在用</span><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>MediaPlayer</span><span
>来播放基于网络的流媒体，应用程序必须请求网络访问权限。</span></p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 8.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:42.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:21.0pt;text-align:left;
text-indent:-21.0pt;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>&lt;uses-permission</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#882288'>android:name</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#008800'>&quot;android.permission.INTERNET&quot;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>/&gt;</span></p>

</div>

<p class=MsoNormal align=left style='margin-left:42.1pt;text-align:left;
text-indent:-21.1pt'><span style='font-size:10.0pt;font-family:Symbol;
color:#333333'>・<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b><span style='font-family:"Calibri","sans-serif";
color:#333333'>Wake Lock Permission</span></b><span
style='font-family:"Calibri","sans-serif";color:#333333'> ―― </span><span
>如果应用程序需要防止屏幕变暗或处理器休眠，或是用到了</span><span
style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html#setScreenOnWhilePlaying(boolean)"><span
style='color:#006699'>MediaPlayer.setScreenOnWhilePlaying()</span></a></span><span
style=';color:#333333'>、</span><span style='font-family:
"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html#setWakeMode(android.content.Context, int)"><span
style='color:#006699'>MediaPlayer.setWakeMode()</span></a></span><span
>方法，则必须请求本权限。</span></p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 8.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:42.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:21.0pt;text-align:left;
text-indent:-21.0pt;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>&lt;uses-permission</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#882288'>android:name</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#008800'>&quot;android.permission.WAKE_LOCK&quot;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>/&gt;</span></p>

</div>

<p class=MsoNormal align=left style='text-align:left'><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>&nbsp;</span></span></p>
<p class=MsoNormal align=left style='text-align:left'><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>&nbsp;</span></span></p>
<p class=MsoNormal align=center style='text-align:center'><span class=Arial><b><span
style='font-size:12.0pt;'>媒体播放器的使用</span></b></span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
class=Arial><span >媒体框架中最重要的组件之一就是</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>类。经过一些很少量的设置，此对象即能够读取、解码并播放音视频内容。它能支持如下多种不同的媒体来源：</span></span></p>
<p class=MsoNormal align=left style='margin-left:21.0pt;text-align:left;
text-indent:0cm'><span style='font-size:10.0pt;font-family:Symbol'>・<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
>本地资源</span></p>
<p class=MsoNormal align=left style='margin-left:21.0pt;text-align:left;
text-indent:0cm'><span style='font-size:10.0pt;font-family:Symbol'>・<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
>内部</span><span style='font-family:"Calibri","sans-serif"'>URI</span><span
>，比如可能来自</span><span style='font-family:"Calibri","sans-serif"'>Content
Resolver</span></p>
<p class=MsoNormal align=left style='margin-left:21.0pt;text-align:left;
text-indent:0cm'><span style='font-size:10.0pt;font-family:Symbol'>・<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
>外部</span><span style='font-family:"Calibri","sans-serif"'>URL</span><span
>（流）</span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
class=Arial><span >关于</span></span><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>Android</span></span><span
class=Arial><span >支持的媒体格式，请参阅文档</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#333333'><a target="_blank" href="http://developer.android.com/guide/appendix/media-formats.html"><span
style='color:#006699'>Android</span><span style=';
color:#006699'><span>支持的媒体格式</span></span></a></span><span
class=Arial><span >。</span></span></p>
<p class=MsoNormal align=left style='text-align:left'><span class=Arial><span
>下面的例子展示了如何播放本地以裸资源方式提供的音频（保存于程序的</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'>res/raw/</span><span
class=Arial><span >目录下）：</span></span></p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 8.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:21.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>MediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> mediaPlayer </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>MediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>create</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>context</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>,</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> R</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>raw</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>sound_file_1</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>);</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>mediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>start</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>();</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#880000'>// </span><span
style=';color:#880000'>不必调用</span><span
style='font-family:"Calibri","sans-serif";color:#880000'>prepare(); create()</span><span
style=';color:#880000'>会自动调用</span></p>

</div>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
>这里的</span><span style='font-family:"Calibri","sans-serif"'>“</span><span
>裸</span><span style='font-family:"Calibri","sans-serif"'>”</span><span
>资源是指系统不会以任何特定方式进行解析的文件。当然，这个资源的内容不应该是原始音频数据，而应是用所支持的格式正确编码并格式化过的媒体文件。</span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
>下面是如何播放来自系统本地提供的</span><span
style='font-family:"Calibri","sans-serif"'>URI</span><span style='font-family:
宋体'>资源（比如通过</span><span style='font-family:"Calibri","sans-serif"'>Content
Resolver</span><span >获取的）：</span></p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 8.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:21.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>Uri</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> myUri </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>....;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#880000'>// </span><span
style=';color:#880000'>在此初始化</span><span
style='font-family:"Calibri","sans-serif";color:#880000'>Uri</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>MediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> mediaPlayer </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>new</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>MediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>();</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>mediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>setAudioStreamType</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>AudioManager</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>STREAM_MUSIC</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>);</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>mediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>setDataSource</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>getApplicationContext</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(),</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> myUri</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>);</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>mediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>prepare</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>();</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>mediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>start</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>();</span></p>

</div>

<p class=MsoNormal align=left style='text-align:left'><span style='font-family:
宋体'>下例是播放来自远程</span><span style='font-family:"Calibri","sans-serif"'>URL</span><span
>的</span><span style='font-family:"Calibri","sans-serif"'>HTTP</span><span
>流：</span></p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 8.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:21.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>String</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> url </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#008800'>&quot;http://........&quot;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#880000'>// </span><span
style=';color:#880000'>在此指定</span><span
style='font-family:"Calibri","sans-serif";color:#880000'>URL</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>MediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> mediaPlayer </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>new</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>MediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>();</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>mediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>setAudioStreamType</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>AudioManager</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>STREAM_MUSIC</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>);</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>mediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>setDataSource</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>url</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>);</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>mediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>prepare</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>();</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#880000'>// </span><span
style=';color:#880000'>可能会耗时很长</span><span
style='font-family:"Calibri","sans-serif";color:#880000'>! </span><span
style=';color:#880000'>（需创建缓存等）</span><span
style='font-family:"Calibri","sans-serif";color:black'>mediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>start</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>();</span></p>

</div>

<div style='border:none;border-left:solid #99AACC 3.0pt;padding:0cm 0cm 0cm 6.0pt;
margin-left:21.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;border:none;padding:0cm'><b><span style='font-family:
宋体'>注意：</span></b><span class=Arial><span >如果通过</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>URL</span></span><span
class=Arial><span >来传送一个来自在线媒体文件的数据流，则该文件必须支持渐进下载（</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>progressive
download</span></span><span class=Arial><span >）。</span></span></p>

</div>

<div style='border:none;border-left:solid #FFCF00 3.0pt;padding:0cm 0cm 0cm 6.0pt;
margin-left:21.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;border:none;padding:0cm'><b><span style='font-family:
宋体'>警告：</span></b><span class=Arial><span >因为所引用的文件有可能会不存在，所以使用</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html#setDataSource(android.content.Context, android.net.Uri)"><span
style='color:#006699'>setDataSource()</span></a></span><span class=Arial><span
>时必须捕捉并且传递</span></span><span
style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/java/lang/IllegalArgumentException.html"><span
style='color:#006699'>IllegalArgumentException</span></a></span><span
class=Arial><span >和</span></span><span
style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/java/io/IOException.html"><span
style='color:#006699'>IOException</span></a></span><span class=Arial><span
>异常。</span></span></p>

</div>

<p class=MsoNormal align=left style='text-align:left'><b><span
style='font-family:"Calibri","sans-serif";color:#3A3A3A'>&nbsp;</span></b></p>
<p class=MsoNormal align=left style='text-align:left'><a name="Async_Prep"><b><span
style=';color:#111111'>异步准备</span></b></a></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
>原则上说，</span><span style='font-family:"Calibri","sans-serif";
color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>的使用可以非常简单。不过有一点很重要，请记住还有一些工作必须正确地加入到典型的</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>Android</span></span><span
class=Arial><span >程序中去。比如，因为要读取并解码媒体数据，</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html#prepare()"><span
style='color:#006699'>prepare()</span></a></span><span class=Arial><span
>的调用可能会运行很长时间。因此在执行这种耗时很长的方法时，应该<b>永远避免从程序的</b></span></span><span
class=Arial><b><span style='font-family:"Calibri","sans-serif"'>UI</span></b></span><span
class=Arial><b><span >线程中调用此类方法</span></b></span><span
class=Arial><span >。那会导致在方法返回之前用户界面</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>UI</span></span><span
class=Arial><span >都处于挂起状态，这样用户体验会十分糟糕，并可能会引发</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>ANR</span></span><span
class=Arial><span >（程序没有响应）错误。即使预计到资源会迅速装载完毕，也请记住在用户界面上任何响应时间超过</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>1/10</span></span><span
class=Arial><span >秒的工作都会导致很明显的停顿，并且会给用户留下一个程序很慢的印象。</span></span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
class=Arial><span >为了避免用户界面</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>UI</span></span><span
class=Arial><span >线程的挂起，请启动另一个线程来准备</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>并在完成后通知主线程。不过这就可能要自行编写线程逻辑，这也是使用</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>时的通常做法，利用其</span></span><span
style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html#prepareAsync()"><span
style='color:#006699'>prepareAsync()</span></a></span><span class=Arial><span
>方法，框架提供一种便利的途径来完成此类任务。这个方法在后台进行媒体的准备工作，并且立即返回。媒体准备完毕后，将会调用</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.OnPreparedListener.html"><span
style='color:#006699'>MediaPlayer.OnPreparedListener</span></a></span><span
class=Arial><span >的</span></span><span
style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.OnPreparedListener.html#onPrepared(android.media.MediaPlayer)"><span
style='color:#006699'>onPrepared()</span></a></span><span class=Arial><span
>方法，该</span></span><span class=Arial><span
style='font-family:"Calibri","sans-serif"'>Listener</span></span><span
class=Arial><span >通过</span></span><span
style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html#setOnPreparedListener(android.media.MediaPlayer.OnPreparedListener)"><span
style='color:#006699'>setOnPreparedListener()</span></a></span><span
class=Arial><span >指定。</span></span></p>
<p class=MsoNormal align=left style='text-align:left'><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>&nbsp;</span></span></p>
<p class=MsoNormal align=left style='text-align:left'><a name=state><b><span
style=';color:#111111'>状态管理</span></b></a></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>另一个应该被关注的要点是其状态模型。也就是说，</span></span><span
style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>拥有一个内部状态，在编写代码时必须时刻注意这个内部状态，因为播放器在某个给定状态下只允许进行特定的操作。如果在错误的状态下执行操作，系统可能会抛出异常或导致其它不可预知的现象发生。</span></span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>类的文档中已展示了完整的</span></span><span
style='font-family:"Calibri","sans-serif";color:#333333'><a target="_blank" href="http://developer.android.com/images/mediaplayer_state_diagram.gif"><span
lang=EN-US style=';color:#006699'><span>状态图</span></span></a></span><span
class=Arial><span >，上面标明了哪些方法会使</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>转换状态。比如，新的</span></span><span
style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>被创建时，处于</span></span><i><span
style='font-family:"Calibri","sans-serif";color:#333333'>Idle</span></i><span
class=Arial><span >状态。这时，应通过调用</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html#setDataSource(android.content.Context, android.net.Uri)"><span
style='color:#006699'>setDataSource()</span></a></span><span class=Arial><span
>进行初始化，进入</span></span><i><span
style='font-family:"Calibri","sans-serif";color:#333333'>Initialized</span></i><span
class=Arial><span >状态。然后必须用</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html#prepare()"><span
style='color:#006699'>prepare()</span></a></span><span class=Arial><span
>或</span></span><span style='font-family:"Calibri","sans-serif";
color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html#prepareAsync()"><span
style='color:#006699'>prepareAsync()</span></a></span><span class=Arial><span
>进行准备工作。待到</span></span><span
style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>准备完毕后，将会进入</span></span><i><span
style='font-family:"Calibri","sans-serif";color:#333333'>Prepared</span></i><span
class=Arial><span >状态，这就意味着可以调用</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html#start()"><span
style='color:#006699'>start()</span></a></span><span class=Arial><span
>来播放媒体了。如状态图所示，这时可以调用</span></span><span
style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html#start()"><span
style='color:#006699'>start()</span></a></span><span class=Arial><span
>、</span></span><span style='font-family:"Calibri","sans-serif";
color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html#pause()"><span
style='color:#006699'>pause()</span></a></span><span class=Arial><span
>和</span></span><span style='font-family:"Calibri","sans-serif";
color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html#seekTo(int)"><span
style='color:#006699'>seekTo()</span></a></span><span class=Arial><span
>在</span></span><i><span style='font-family:
"Calibri","sans-serif";color:#333333'>Started</span></i><span class=Arial><span
>、</span></span><i><span style='font-family:
"Calibri","sans-serif";color:#333333'>Paused</span></i><span class=Arial><span
>和</span></span><i><span style='font-family:
"Calibri","sans-serif";color:#333333'>PlaybackCompleted</span></i><span
class=Arial><span >状态之间进行切换。不过请注意，一旦调用了</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html#stop()"><span
style='color:#006699'>stop()</span></a></span><span class=Arial><span
>，在下次</span></span><span style='font-family:
"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>准备好之前就不能再次调用</span></span><span
style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html#start()"><span
style='color:#006699'>start()</span></a></span><span class=Arial><span
>了。</span></span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
class=Arial><span >在编写有关</span></span><span
style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>对象的代码时请时刻牢记</span></span><span
style='font-family:"Calibri","sans-serif";color:#333333'><a target="_blank" href="http://developer.android.com/images/mediaplayer_state_diagram.gif"><span
lang=EN-US style=';color:#006699'><span>状态图</span></span></a></span><span
style=';color:#333333'>，</span><span >因为常见的</span><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>bug</span><span
>原因就是在错误的状态下调用了不合适的方法。</span></p>
<p class=MsoNormal align=left style='text-align:left'><span
style='font-family:"Calibri","sans-serif";color:#333333'>&nbsp;</span></p>
<p class=MsoNormal align=left style='text-align:left'><a name=release><b><span
style=';color:#111111'>释放</span></b></a><b><span
style='font-family:"Calibri","sans-serif";color:#111111'>MediaPlayer</span></b></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>可能会消耗较多的系统资源。因此应该时刻注意，避免不必要时还维持</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>实例的运行。应该总是在用完后及时调用</span></span><span
style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html#release()"><span
style='color:#006699'>release()</span></a></span><span class=Arial><span
>，以确保所申请的系统资源得到有效释放。比如，正在使用</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>时</span></span><span class=Arial><span
style='font-family:"Calibri","sans-serif"'>activity</span></span><span
class=Arial><span >收到了一个</span></span><span
style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/app/Activity.html#onStop()"><span
style='color:#006699'>onStop()</span></a></span><span class=Arial><span
>调用，这时就必须释放</span></span><span
style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>，因为</span></span><span class=Arial><span
style='font-family:"Calibri","sans-serif"'>activity</span></span><span
class=Arial><span >不与用户交互时没必要再保持播放器的运行（除非在后台播放媒体，这会在下节讨论）。当然，如果</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>activity</span></span><span
class=Arial><span >再次被激活或者再次被启动，则需要创建一个新的</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>并再次准备之后才能恢复播放。</span></span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
class=Arial><span >下面是释放并注销</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>的语句：</span></span></p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 8.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:21.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>mediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>release</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>();</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>mediaPlayer </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>null</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>;</span></p>

</div>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
class=Arial><span >举个例子，假如停止</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>activity</span></span><span
class=Arial><span >时忘记释放</span></span><span
style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>了，但在</span></span><span class=Arial><span
style='font-family:"Calibri","sans-serif"'>activity</span></span><span
class=Arial><span >再次启动时又创建了一个新的播放器，看看可能会产生的问题。众所周知，用户切换屏幕方向（或者其它方式改变设备设置）时，系统默认会重启</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>activity</span></span><span
class=Arial><span >，这样系统资源可能会由于用户在横向纵向间来回旋转而很快耗尽。因为每改变一次方向，就会创建一个永远不会释放的新</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>。（关于运行时的重启，详见</span></span><span
style='font-family:"Calibri","sans-serif";color:#333333'><a target="_blank" href="http://developer.android.com/guide/topics/resources/runtime-changes.html"><span
lang=EN-US style=';color:#006699'><span>运行时</span></span><span
lang=EN-US style=';color:#006699'><span>变化</span></span><span
lang=EN-US style=';color:#006699'><span>的处理</span></span></a></span><span
style=';color:#333333'>。</span><span class=Arial><span
>）</span></span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
class=Arial><span >如果期望在用户离开</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>activity</span></span><span
class=Arial><span >后还能继续播放</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>“</span></span><span
class=Arial><span >后台媒体</span></span><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>”</span></span><span
class=Arial><span >，正如系统内置音乐播放器那样，则需要通过</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/app/Service.html"><span
style='color:#006699'>Service</span></a></span><span class=Arial><span
>来控制</span></span><span style='font-family:
"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>，这在</span></span><span style='font-family:
"Calibri","sans-serif";color:#333333'><a href="#service"><span
style=';color:#006699'><span>使用</span></span><span
lang=EN-US style=';color:#006699'><span>带</span></span><span
style='color:#006699'>MediaPlayer</span><span style='font-family:
宋体;color:#006699'><span>的服务</span></span></a></span><span
class=Arial><span >中讨论。</span></span></p>
<p class=MsoNormal align=left style='text-align:left'><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>&nbsp;</span></span></p>
<p class=MsoNormal align=left style='text-align:left'><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>&nbsp;</span></span></p>
<p class=MsoNormal align=center style='text-align:center'><span class=Arial><b><span
style='font-size:12.0pt;'>使用带</span></b></span><span class=Arial><b><span
lang=EN-US style='font-size:12.0pt;font-family:"Calibri","sans-serif"'>MediaPlayer</span></b></span><span
class=Arial><b><span style='font-size:12.0pt;'>的服务</span></b></span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
class=Arial><span >如果程序需要在不显示时还能在后台播放媒体</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>――</span></span><span
class=Arial><span >也就是说期望在用户操作其它程序时也能继续播放</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>――</span></span><span
class=Arial><span >那就必须启动一个</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/app/Service.html"><span
style='color:#006699'>Service</span></a></span><span class=Arial><span
>并从服务中控制</span></span><span style='font-family:
"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>实例。这种情况下应该十分小心，因为用户和系统都期望运行后台服务的应用应该能与系统其它功能同时运行。如果应用不能满足这个要求，用户体验将会很糟糕。本节描述了应注意的主要问题，并提供解决建议。</span></span></p>
<p class=MsoNormal align=left style='text-align:left'><a name="Async_run"><b><span
>异步运行</span></b></a></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
class=Arial><span >首先，如同</span></span><span
style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/app/Activity.html"><span
style='color:#006699'>Activity</span></a></span><span class=Arial><span
>，所有</span></span><span style='font-family:
"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/app/Service.html"><span
style='color:#006699'>Service</span></a></span><span class=Arial><span
>默认运行在单个线程中</span></span><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>――</span></span><span
class=Arial><span >事实上，如果从同一个应用程序运行</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>activity</span></span><span
class=Arial><span >和服务，它们默认会使用同一个进程（</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>“</span></span><span
class=Arial><span >主进程</span></span><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>”</span></span><span
class=Arial><span >）。因此，服务就需要快速处理传入的意图，并且响应这些意图时还不能执行耗时较长的计算工作。如果需要执行繁重的工作或者阻塞调用，必须以异步方式执行这类任务：创建另一个线程来执行，或利用框架提供的异步处理功能。</span></span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
class=Arial><span >比如，假设在主线程中用到</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>，就应该用</span></span><span style='font-family:
"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html#prepareAsync()"><span
style='color:#006699'>prepareAsync()</span></a></span><span class=Arial><span
>来代替</span></span><span style='font-family:
"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html#prepare()"><span
style='color:#006699'>prepare()</span></a></span><span class=Arial><span
>，并实现</span></span><span style='font-family:
"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.OnPreparedListener.html"><span
style='color:#006699'>MediaPlayer.OnPreparedListener</span></a></span><span
class=Arial><span >以便在准备完毕后得到通知，然后就可以开始播放了。示例如下：</span></span></p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 8.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:21.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>public</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>class</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>MyService</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>extends</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>Service</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>implements</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>MediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>OnPreparedListener</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>{</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#000088'>private</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>static</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>final</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> ACTION_PLAY </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#008800'>&quot;com.example.action.PLAY&quot;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#660066'>MediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> mMediaPlayer
</span><span style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>null</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#000088'>public</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>int</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>
onStartCommand</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>(</span><span style='font-family:"Calibri","sans-serif";
color:#660066'>Intent</span><span style='font-family:"Calibri","sans-serif";
color:black'> intent</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>,</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>int</span><span style='font-family:"Calibri","sans-serif";
color:black'> flags</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>,</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>int</span><span style='font-family:"Calibri","sans-serif";
color:black'> startId</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>)</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>{</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>...</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>if</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>(</span><span style='font-family:"Calibri","sans-serif";
color:black'>intent</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>getAction</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>().</span><span style='font-family:"Calibri","sans-serif";
color:black'>equals</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>(</span><span style='font-family:"Calibri","sans-serif";
color:black'>ACTION_PLAY</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>))</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>{</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; mMediaPlayer </span><span
style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>...</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#880000'>// </span><span
style=';color:#880000'>在此初始化</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; mMediaPlayer</span><span
style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>setOnPreparedListener</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>this</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>);</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; mMediaPlayer</span><span
style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>prepareAsync</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>();</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#880000'>// </span><span style=';color:#880000'>为了不阻塞主线程而异步准备</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>}</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#666600'>}</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
background:#FAFAFA;border:none;padding:0cm'><span style='font-family:
"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
background:#FAFAFA;border:none;padding:0cm'><span style='font-family:
"Calibri","sans-serif";color:black'>&nbsp; &nbsp; </span><span
style='font-family:"Calibri","sans-serif";color:#880000'>/** </span><span
style=';color:#880000'>由</span><span style='font-family:
"Calibri","sans-serif";color:#880000'>MediaPlayer</span><span style='font-family:
宋体;color:#880000'>准备完毕后调用</span><span style='font-family:"Calibri","sans-serif";
color:#880000'> <span>*/</span></span><span
style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
background:#FAFAFA;border:none;padding:0cm'><span style='font-family:
"Calibri","sans-serif";color:black'>&nbsp; &nbsp; </span><span
style='font-family:"Calibri","sans-serif";color:#000088'>public</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>void</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> onPrepared</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>MediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> player</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>)</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>{</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
background:#FAFAFA;border:none;padding:0cm'><span style='font-family:
"Calibri","sans-serif";color:black'>&nbsp; &nbsp; &nbsp; &nbsp; player</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>start</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>();</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
background:#FAFAFA;border:none;padding:0cm'><span style='font-family:
"Calibri","sans-serif";color:black'>&nbsp; &nbsp; </span><span
style='font-family:"Calibri","sans-serif";color:#666600'>}</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
background:#FAFAFA;border:none;padding:0cm'><span style='font-family:
"Calibri","sans-serif";color:#666600'>}</span></p>

</div>

<p class=MsoNormal align=left style='text-align:left'><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>&nbsp;</span></span></p>
<p class=MsoNormal align=left style='text-align:left'><a name="Async_error"><b><span
style=';color:#3A3A3A'>异步错误的处理</span></b></a></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
class=Arial><span >在同步操作时，错误通常会以异常或错误代码的方式展现出来；但如果用到了异步资源，应该确保应用程序每次都能正确地获得错误通知。在使用</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>的时候，可以通过实现一个</span></span><span
style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.OnErrorListener.html"><span
style='color:#006699'>MediaPlayer.OnErrorListener</span></a></span><span
class=Arial><span >来达到以上目标，当然还要在</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>实例中进行设定才行：</span></span></p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 8.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:21.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>public</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>class</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>MyService</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>extends</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>Service</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>implements</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>MediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>OnErrorListener</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>{</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#660066'>MediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> mMediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#000088'>public</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>void</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>
initMediaPlayer</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>()</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>{</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#880000'>// ...</span><span style=';color:#880000'>在此初始化</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#880000'>MediaPlayer...</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; mMediaPlayer</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>setOnErrorListener</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>(</span><span style='font-family:"Calibri","sans-serif";
color:#000088'>this</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>);</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#666600'>}</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#006666'>@Override</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#000088'>public</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>boolean</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> onError</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>MediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> mp</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>,</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>int</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> what</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>,</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>int</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> extra</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>)</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>{</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#880000'>// ... </span><span style=';color:#880000'>合适地处理</span><span
style='font-family:"Calibri","sans-serif";color:#880000'> <span>...</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#880000'>// MediaPlayer</span><span style=';color:#880000'>已经切换到</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#880000'>Error</span><span
style=';color:#880000'>状态，必须重启</span><span
style='font-family:"Calibri","sans-serif";color:#880000'>!</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#666600'>}</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>}</span></p>

</div>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
class=Arial><span >记住这点非常重要：当发生错误时，</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>将切换到</span></span><i><span style='font-family:
"Calibri","sans-serif";color:#333333'>Error</span></i><span class=Arial><span
>状态（关于完整的状态图请参阅</span></span><span
style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>类的文档），再次使用前必须重启播放器。</span></span></p>
<p class=MsoNormal align=left style='text-align:left'><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>&nbsp;</span></span></p>
<p class=MsoNormal align=left style='text-align:left'><a name=wakelock><b><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#333333'>Wake Lock</span></b></a><b><span
style=';color:#3A3A3A'>的使用</span></b></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
>如果应用程序是为后台播放媒体而设计的，那么即使服务仍在运行，但设备可能会进入休眠状态。因为设备休眠时</span><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>Android</span><span
>系统会尝试节省电力，任何不必要的手机功能将会关闭，包括</span><span
style='font-family:"Calibri","sans-serif"'>CPU</span><span style='font-family:
宋体'>和</span><span style='font-family:"Calibri","sans-serif"'>WiFi</span><span
>部件。但是，如果服务正在播放音乐或读取音乐数据流，就需要防止系统对播放进行干扰。</span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
>为了确保服务在上述情况下能维持正常运行，必须使用</span><span
style='font-family:"Calibri","sans-serif"'>“</span><span style='font-family:
宋体'>唤醒锁</span><span style='font-family:"Calibri","sans-serif"'>”</span><span
>（</span><span style='font-family:"Calibri","sans-serif"'>wake
lock</span><span >）。</span><span
style='font-family:"Calibri","sans-serif"'>wake lock</span><span
>是一种通知系统的途径：表示应用程序需要用到一些手机空闲时也保持可用的功能。</span></p>

<div style='border:none;border-left:solid #FFCF00 3.0pt;padding:0cm 0cm 0cm 6.0pt;
margin-left:21.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
border:none;padding:0cm'><b><span style=';color:#333333'>注意：</span></b><span
class=Arial><span style='font-family:"Calibri","sans-serif"'> </span></span><span
class=Arial><span >应该尽量少用</span></span><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>wake lock</span></span><span
class=Arial><span >，并且仅当确实需要时才保持锁定状态，因为它会显著减少设备的电池寿命。</span></span></p>

</div>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
class=Arial><span >为了确保</span></span><span
style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>播放时</span></span><span class=Arial><span
style='font-family:"Calibri","sans-serif"'>CPU</span></span><span class=Arial><span
>能够保持工作，应在初始化</span></span><span
style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>时调用</span></span><span style='font-family:
"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html#setWakeMode(android.content.Context, int)"><span
style='color:#006699'>setWakeMode()</span></a></span><span class=Arial><span
>方法。一旦调用完成，</span></span><span
style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>会在播放过程中保持这个特殊的锁，并在暂停和停止时释放该锁：</span></span></p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 8.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:21.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>mMediaPlayer </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>new</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>MediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>();</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#880000'>// ... </span><span
style=';color:#880000'>在此执行其它初始化工作</span><span style='font-family:
"Calibri","sans-serif";color:#880000'> <span>...</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>mMediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>setWakeMode</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>getApplicationContext</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(),</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>PowerManager</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>PARTIAL_WAKE_LOCK</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>);</span></p>

</div>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
class=Arial><span >不过，本例中申请的</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>wake lock</span></span><span
class=Arial><span >只是保证了</span></span><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>CPU</span></span><span
class=Arial><span >维持唤醒状态。如果正在通过网络读取流媒体并且用到了</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>Wi-Fi</span></span><span
class=Arial><span >，则应该再同时保持一个</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/net/wifi/WifiManager.WifiLock.html"><span
style='color:#006699'>WifiLock</span></a></span><span class=Arial><span
>，该锁必须手动申请和释放。因此，假如开始准备一个使用远程</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>URL</span></span><span
class=Arial><span >的</span></span><span
style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>，就应该创建并申请一个</span></span><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>Wi-Fi</span></span><span
class=Arial><span >锁。例如：</span></span></p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 8.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:21.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>WifiLock</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> wifiLock </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>((</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>WifiManager</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>)</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>
getSystemService</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>(</span><span style='font-family:"Calibri","sans-serif";
color:#660066'>Context</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>WIFI_SERVICE</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>))</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>createWifiLock</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>WifiManager</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>WIFI_MODE_FULL</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>,</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#008800'>&quot;mylock&quot;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>);</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>wifiLock</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>acquire</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>();</span></p>

</div>

<p class=MsoNormal align=left style='text-align:left'><span style='font-family:
宋体'>如果暂停或停止播放媒体，或者不再需要使用网络，就应该及时释放该锁：</span></p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 8.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:21.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>wifiLock</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>release</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>();</span></p>

</div>

<p class=MsoNormal align=left style='text-align:left'><b><span
style='font-family:"Calibri","sans-serif";color:#3A3A3A'>&nbsp;</span></b></p>
<p class=MsoNormal align=left style='text-align:left'><a name="run_as_service"><b><span
style=';color:#3A3A3A'>作为后台服务运行</span></b></a></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
>服务经常用于执行一些后台任务，比如读取邮件、同步数据、下载数据等。这些情况下，用户不会明显察觉服务正在运行，甚至可能都不会注意到某些服务曾被中止而过段时间又重新开始运行。</span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
>但是就播放音乐的服务而言，显然这是用户能明显察觉的服务，任何中断都会显著影响到用户的体验。此外，该服务还是用户可能期望与其交互的服务。在这种情况下，此服务应该作为</span><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>“</span><span
>后台服务</span><span style='font-family:"Calibri","sans-serif"'>”</span><span
>来运行。后台服务保持较高的系统重要性级别</span><span
style='font-family:"Calibri","sans-serif"'>――</span><span style='font-family:
宋体'>系统几乎永远都不会关闭服务，因为服务对于用户而言至关重要。即使是运行在后台，服务仍必须提供状态栏通知，以保证用户知晓服务正在运行，并允许用户打开与服务交互的</span><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>activity</span><span
>。</span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
>为了把服务切换到后台，必须为状态栏创建一个</span><span
style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/app/Notification.html"><span
style='color:#006699'>Notification</span></a></span><span style='font-family:
宋体;color:#333333'>，</span><span >并且从</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/app/Service.html"><span
style='color:#006699'>Service</span></a></span><span >中调用</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/app/Service.html#startForeground(int, android.app.Notification)"><span
style='color:#006699'>startForeground()</span></a></span><span
>。例如：</span></p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 8.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:21.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>String</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> songName</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#880000'>// assign
the song name to songName</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>PendingIntent</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> pi </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>PendingIntent</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>getActivity</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>getApplicationContext</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(),</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#006666'>0</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>,</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span
style='font-family:"Calibri","sans-serif";color:#000088'>new</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>Intent</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>getApplicationContext</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(),</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>MainActivity</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>class</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>),</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span
style='font-family:"Calibri","sans-serif";color:#660066'>PendingIntent</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>FLAG_UPDATE_CURRENT</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>);</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>Notification</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> notification
</span><span style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>new</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>Notification</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>();</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>notification</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>tickerText </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> text</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>notification</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>icon </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> R</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>drawable</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>play0</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>notification</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>flags </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>|=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>Notification</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>FLAG_ONGOING_EVENT</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>notification</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>setLatestEventInfo</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>getApplicationContext</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(),</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#008800'>&quot;MusicPlayerSample&quot;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>,</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span
style='font-family:"Calibri","sans-serif";color:#008800'>&quot;Playing: &quot;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>+</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> songName</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>,</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> pi</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>);</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>startForeground</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>NOTIFICATION_ID</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>,</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> notification</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>);</span></p>

</div>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
class=Arial><span >服务在后台运行期间，此</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>notification</span></span><span
class=Arial><span >将显示在设备的通知区域。如果用户选中此通知，系统会提交一个预先已实现的</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/app/PendingIntent.html"><span
style='color:#006699'>PendingIntent</span></a></span><span style='font-family:
宋体;color:#007000'>。</span><span class=Arial><span >以下例子将打开一个</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>activity</span></span><span
class=Arial><span >（</span></span><span
style='font-family:"Calibri","sans-serif";color:#007000'>MainActivity</span><span
class=Arial><span >）。</span></span></p>
<p class=MsoNormal align=left style='text-align:left'><span style='font-family:
宋体'>图</span><span style='font-family:"Calibri","sans-serif"'>1</span><span
>展示了通知如何显示给用户：</span></p>
<p class=MsoNormal align=center style='text-align:center'><span
style='font-family:"Calibri","sans-serif";color:#333333'><img border=0
width=162 height=242
src="image/2011-11-17_1.jpg">&nbsp;&nbsp;
<img border=0 width=161 height=241
src="image/2011-11-17_2.jpg"></span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><b><span
style=';color:#333333'>图</span></b><b><span
style='font-family:"Calibri","sans-serif";color:#333333'>1.</span></b><span
class=Arial><span >后台服务通知的屏幕截图，左图是状态栏的通知图标，右图是展开的</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>View</span></span><span
class=Arial><span >。</span></span></p>
<p class=MsoNormal align=left style='text-align:left'><span class=Arial><span
>只有那些确实运行着用户明显关注任务的服务，才应该保持为</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>“</span></span><span
class=Arial><span >后台服务</span></span><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>”</span></span><span
class=Arial><span >状态。一旦不再需要，就应该调用</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/app/Service.html#stopForeground(boolean)"><span
style='color:#006699'>stopForeground()</span></a></span><span class=Arial><span
>进行释放：</span></span></p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 8.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:21.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>stopForeground</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>true</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>);</span></p>

</div>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
class=Arial><span >详情请参阅</span></span><span
style='font-family:"Calibri","sans-serif";color:#333333'><a target="_blank" href="http://developer.android.com/guide/topics/fundamentals/services.html#Foreground"><span
lang=EN-US style=';color:#006699'><span>服务</span></span></a></span><span
class=Arial><span >和</span></span><span
style='font-family:"Calibri","sans-serif";color:#333333'><a target="_blank" href="http://developer.android.com/guide/topics/ui/notifiers/notifications.html"><span
lang=EN-US style=';color:#006699'><span>状态栏通知</span></span></a></span><span
class=Arial><span >的文档。</span></span></p>
<p class=MsoNormal align=left style='text-align:left'><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>&nbsp;</span></span></p>
<p class=MsoNormal align=left style='text-align:left'><a name="audio_focus"><b><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>Audio Focus</span></b></a><b><span
>的处理</span></b></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
>虽然在任一给定时刻只能运行一个</span><span style='font-family:
"Calibri","sans-serif"'>activity</span><span >，</span><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>Android</span><span
>仍是一个多任务环境。这向使用音频的应用程序提出了一个特殊的挑战，因为系统只有一路音频输出，但可能会存在多个媒体服务，它们会相互争夺这个音频输出的使用权。</span><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>Android 2.2</span><span
>之前，没有什么内部机制来解决这个问题，某些情况下这可能会导致用户体验很糟糕。比如在用户听音乐时，其它应用程序需要通知用户一个非常重要的事件，用户可能会由于音乐声音较大而听不到通知提示音。自</span><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>Android 2.2</span><span
>开始，系统为应用程序提供了一种使用设备音频输出的协调机制。这种机制叫做</span><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>Audio Focus</span><span
>。</span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
>当应用程序需要输出诸如音乐或通知音之类的音频时，应该总是提出</span><span
style='font-family:"Calibri","sans-serif"'>audio focus</span><span
>请求。一但获得了</span><span style='font-family:"Calibri","sans-serif"'>focus</span><span
>，就可以自由使用音频输出，但应该时刻注意</span><span
style='font-family:"Calibri","sans-serif"'>focus</span><span style='font-family:
宋体'>的变化情况。一旦接到放弃</span><span style='font-family:"Calibri","sans-serif"'>audio
focus</span><span >的通知，就应该立即关闭音频或者把音量调低至静音状态（正如</span><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>“ducking”――</span><span
>此标志表明哪一个更合适），并且在再次获得</span><span
style='font-family:"Calibri","sans-serif"'>focus</span><span style='font-family:
宋体'>之后才能恢复正常音量播放。</span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>Audio Focus</span><span
>事实上具有良好的协作性。也就是说，虽然期望（强烈建议）应用程序能遵守</span><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>audio focus</span><span
>规则，但此规则并不是系统强制要求的。如果应用程序需要在失去</span><span
style='font-family:"Calibri","sans-serif"'>audio focus</span><span
>后也能以正常音量播放音乐，系统也不会阻止。但是用户体验很可能会很糟糕，并且很可能会删除这种不够礼貌的应用程序。</span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
>要发起</span><span class=Arial><span
style='font-family:"Calibri","sans-serif"'>audio focus</span></span><span
class=Arial><span >请求，必须调用</span></span><span
style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/AudioManager.html"><span
style='color:#006699'>AudioManager</span></a></span><span class=Arial><span
>中的</span></span><span style='font-family:
"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/AudioManager.html#requestAudioFocus(android.media.AudioManager.OnAudioFocusChangeListener, int, int)"><span
style='color:#006699'>requestAudioFocus()</span></a></span><span class=Arial><span
>，示例如下：</span></span></p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 8.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:21.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>AudioManager</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> audioManager
</span><span style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>AudioManager</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>)</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>
getSystemService</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>(</span><span style='font-family:"Calibri","sans-serif";
color:#660066'>Context</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>AUDIO_SERVICE</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>);</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>int</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> result </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> audioManager</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>requestAudioFocus</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>this</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>,</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>AudioManager</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>STREAM_MUSIC</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>,</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#660066'>AudioManager</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>AUDIOFOCUS_GAIN</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>);</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>if</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>result </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>!=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>AudioManager</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>AUDIOFOCUS_REQUEST_GRANTED</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>)</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>{</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#880000'>//
</span><span style=';color:#880000'>无法获取</span><span
style='font-family:"Calibri","sans-serif";color:#880000'>audio focus.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>}</span></p>

</div>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/AudioManager.html#requestAudioFocus(android.media.AudioManager.OnAudioFocusChangeListener, int, int)"><span
style='color:#006699'>requestAudioFocus()</span></a></span><span class=Arial><span
>的第一个参数是</span></span><span style='font-family:
"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/AudioManager.OnAudioFocusChangeListener.html"><span
style='color:#006699'>AudioManager.OnAudioFocusChangeListener</span></a></span><span
class=Arial><span >对象，每次</span></span><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>audio focus</span></span><span
class=Arial><span >发生改变时都会调用该对象的</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/AudioManager.OnAudioFocusChangeListener.html#onAudioFocusChange(int)"><span
style='color:#006699'>onAudioFocusChange()</span></a></span><span class=Arial><span
>方法。因此，必须在服务和</span></span><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>activity</span></span><span
class=Arial><span >中都实现这个接口。例如：</span></span></p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 8.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:21.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>class</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>MyService</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>extends</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>Service</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span
style='font-family:"Calibri","sans-serif";color:#000088'>implements</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>AudioManager</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>OnAudioFocusChangeListener</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>{</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#880000'>//
....</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#000088'>public</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>void</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>
onAudioFocusChange</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>(</span><span style='font-family:"Calibri","sans-serif";
color:#000088'>int</span><span style='font-family:"Calibri","sans-serif";
color:black'> focusChange</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>)</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>{</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#880000'>// </span><span style=';color:#880000'>根据</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#880000'>focus</span><span
style=';color:#880000'>的改变进行处理</span><span
style='font-family:"Calibri","sans-serif";color:#880000'>...</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#666600'>}</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>}</span></p>

</div>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'>focusChange</span><span
class=Arial><span >参数标明了</span></span><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>audio focus</span></span><span
class=Arial><span >已经发生改变，它可能会是以下值之一（在</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/AudioManager.html"><span
style='color:#006699'>AudioManager</span></a></span><span class=Arial><span
>类中定义了所有下列常数）：</span></span></p>
<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'><span class=Arial><span style='font-size:10.0pt;
font-family:Symbol'>・<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style='font-family:"Calibri","sans-serif";
color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/AudioManager.html#AUDIOFOCUS_GAIN"><span
style='color:#006699'>AUDIOFOCUS_GAIN</span></a></span><span class=Arial><span
>：已经获得了</span></span><span class=Arial><span
style='font-family:"Calibri","sans-serif"'>audio focus</span></span><span
class=Arial><span >。</span></span></p>
<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'><span class=Arial><span style='font-size:10.0pt;
font-family:Symbol'>・<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style='font-family:"Calibri","sans-serif";
color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/AudioManager.html#AUDIOFOCUS_LOSS"><span
style='color:#006699'>AUDIOFOCUS_LOSS</span></a></span><span class=Arial><span
>：似乎已失去</span></span><span class=Arial><span
style='font-family:"Calibri","sans-serif"'>audio focus</span></span><span
class=Arial><span >较长时间了。这时必须停止所有的音频播放。因为不应该会较长时间地失去</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>focus</span></span><span
class=Arial><span >，这是尽可能多地清理资源的绝好时机。比如应该释放</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>。</span></span></p>
<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'><span class=Arial><span style='font-size:10.0pt;
font-family:Symbol'>・<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style='font-family:"Calibri","sans-serif";
color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/AudioManager.html#AUDIOFOCUS_LOSS_TRANSIENT"><span
style='color:#006699'>AUDIOFOCUS_LOSS_TRANSIENT</span></a></span><span
class=Arial><span >：暂时失去了</span></span><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>audio focus</span></span><span
class=Arial><span >，但应该会马上取回来。这时必须停止所有的音频播放工作，但因为可能马上再次获得</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>focus</span></span><span
class=Arial><span >，所以可以保持资源。</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'> </span></span></p>
<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'><span class=Arial><span style='font-size:10.0pt;
font-family:Symbol'>・<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span style='font-family:"Calibri","sans-serif";
color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/AudioManager.html#AUDIOFOCUS_LOSS_TRANSIENT_CAN_DUCK"><span
style='color:#006699'>AUDIOFOCUS_LOSS_TRANSIENT_CAN_DUCK</span></a></span><span
class=Arial><span >：暂时失去了</span></span><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>audio focus</span></span><span
class=Arial><span >，但允许继续安静（小声）地播放音频，而不是完全关闭音频。</span></span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
>以下是实现的例子：</span></p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 8.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:21.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>public</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>void</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>
onAudioFocusChange</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>(</span><span style='font-family:"Calibri","sans-serif";
color:#000088'>int</span><span style='font-family:"Calibri","sans-serif";
color:black'> focusChange</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>)</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>{</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#000088'>switch</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>focusChange</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>)</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>{</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>case</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#660066'>AudioManager</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>AUDIOFOCUS_GAIN</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>:</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#880000'>// </span><span style=';color:#880000'>恢复播放</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>if</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>(</span><span style='font-family:"Calibri","sans-serif";
color:black'>mMediaPlayer </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>==</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>null</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>)</span><span style='font-family:"Calibri","sans-serif";
color:black'> initMediaPlayer</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>();</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>else</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>if</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>(!</span><span style='font-family:"Calibri","sans-serif";
color:black'>mMediaPlayer</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>isPlaying</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>())</span><span style='font-family:"Calibri","sans-serif";
color:black'> mMediaPlayer</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>start</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>();</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; mMediaPlayer</span><span
style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>setVolume</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
 style='font-family:"Calibri","sans-serif";color:#006666'>1.0f</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>,</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
 style='font-family:"Calibri","sans-serif";color:#006666'>1.0f</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>);</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>break</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>;</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>case</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#660066'>AudioManager</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>AUDIOFOCUS_LOSS</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>:</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#880000'>// </span><span style=';color:#880000'>长时间失去</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#880000'>focus</span><span
style=';color:#880000'>：停止播放并释放</span><span
style='font-family:"Calibri","sans-serif";color:#880000'>media player</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>if</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>(</span><span style='font-family:"Calibri","sans-serif";
color:black'>mMediaPlayer</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>isPlaying</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>())</span><span style='font-family:"Calibri","sans-serif";
color:black'> mMediaPlayer</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>stop</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>();</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; mMediaPlayer</span><span
style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>release</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>();</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; mMediaPlayer </span><span
style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>null</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>break</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>;</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>case</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#660066'>AudioManager</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>AUDIOFOCUS_LOSS_TRANSIENT</span><span style='font-family:
"Calibri","sans-serif";color:#666600'>:</span><span
style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#880000'>// </span><span style=';color:#880000'>暂时失去</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#880000'>focus</span><span
style=';color:#880000'>，但必须停止播放</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#880000'>// </span><span style=';color:#880000'>可能会很快恢复播放，所以不释放</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#880000'>media
player</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>if</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>(</span><span style='font-family:"Calibri","sans-serif";
color:black'>mMediaPlayer</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>isPlaying</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>())</span><span style='font-family:"Calibri","sans-serif";
color:black'> mMediaPlayer</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>pause</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>();</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>break</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>;</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>case</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#660066'>AudioManager</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>AUDIOFOCUS_LOSS_TRANSIENT_CAN_DUCK</span><span
style='font-family:"Calibri","sans-serif";color:#666600'>:</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#880000'>// </span><span style=';color:#880000'>暂时失去</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#880000'>focus</span><span
style=';color:#880000'>，但可以保持较低级别的播放</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>if</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>(</span><span style='font-family:"Calibri","sans-serif";
color:black'>mMediaPlayer</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>isPlaying</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>())</span><span style='font-family:"Calibri","sans-serif";
color:black'> mMediaPlayer</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>setVolume</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>(</span><span
 style='font-family:"Calibri","sans-serif";color:#006666'>0.1f</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>,</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
 style='font-family:"Calibri","sans-serif";color:#006666'>0.1f</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>);</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>break</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>;</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#666600'>}</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>}</span></p>

</div>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
>请记住</span><span style='font-family:"Calibri","sans-serif"'>audio
focus API</span><span >在</span><span
style='font-family:"Calibri","sans-serif"'>API level 8 (Android 2.2)</span><span
>以上版本才可用。假如需要支持较低版本的</span><span
style='font-family:"Calibri","sans-serif"'>Android</span><span
>，应该采取向后兼容的方案，使得程序能在获得支持时使用此功能、未获支持时则向下平滑过渡。</span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
>通过反射机制调用</span><span class=Arial><span
style='font-family:"Calibri","sans-serif"'>audio focus</span></span><span
class=Arial><span >方法，</span></span><span
>或者在单独的类中（叫做</span><span style='font-family:
"Calibri","sans-serif";color:#007000'>AudioFocusHelper</span><span class=Arial><span
>）</span></span><span >实现全部</span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>audio
focus</span></span><span class=Arial><span >功能，就可以获得良好的向后兼容性。以下是这种类的一个示例：</span></span></p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 8.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:21.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>public</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>class</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>AudioFocusHelper</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>implements</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>AudioManager</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>OnAudioFocusChangeListener</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>{</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#660066'>AudioManager</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>
mAudioManager</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>;</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
text-indent:22.5pt;layout-grid-mode:char;background:#FAFAFA;border:none;
padding:0cm'><span style='font-family:"Calibri","sans-serif";
color:#880000'>// </span><span style=';color:#880000'>在此写入其它内容，</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
text-indent:22.5pt;layout-grid-mode:char;background:#FAFAFA;border:none;
padding:0cm'><span style='font-family:"Calibri","sans-serif";
color:#880000'>// </span><span style=';color:#880000'>将保存一个接口的引用，用于通知服务</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#880000'>focus </span><span
style=';color:#880000'>已发生改变。</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#000088'>public</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>AudioFocusHelper</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>Context</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> ctx</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>,</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#880000'>/* other
arguments here */</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>)</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>{</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; mAudioManager </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>=</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>(</span><span style='font-family:"Calibri","sans-serif";
color:#660066'>AudioManager</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>)</span><span style='font-family:"Calibri","sans-serif";
color:black'> mContext</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>getSystemService</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>(</span><span style='font-family:"Calibri","sans-serif";
color:#660066'>Context</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>AUDIO_SERVICE</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>);</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#880000'>// ...</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#666600'>}</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#000088'>public</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>boolean</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> requestFocus</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>()</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>{</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>return</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#660066'>AudioManager</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>AUDIOFOCUS_REQUEST_GRANTED </span><span
style='font-family:"Calibri","sans-serif";color:#666600'>==</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; mAudioManager</span><span
style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>requestAudioFocus</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>mContext</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>,</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>AudioManager</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>STREAM_MUSIC</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>,</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#660066'>AudioManager</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>AUDIOFOCUS_GAIN</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>);</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#666600'>}</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#000088'>public</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>boolean</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> abandonFocus</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>()</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>{</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>return</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#660066'>AudioManager</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>AUDIOFOCUS_REQUEST_GRANTED </span><span
style='font-family:"Calibri","sans-serif";color:#666600'>==</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; mAudioManager</span><span
style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>abandonAudioFocus</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>this</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>);</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#666600'>}</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#006666'>@Override</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#000088'>public</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>void</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>
onAudioFocusChange</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>(</span><span style='font-family:"Calibri","sans-serif";
color:#000088'>int</span><span style='font-family:"Calibri","sans-serif";
color:black'> focusChange</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>)</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>{</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#880000'>// </span><span style=';color:#880000'>服务获知</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#880000'>focus</span><span
style=';color:#880000'>的变动</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#666600'>}</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>}</span></p>

</div>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt;
layout-grid-mode:char'><span class=Arial><span >仅当检测到系统运行于</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>API
level 8</span></span><span class=Arial><span >以上版本时，才可以创建</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'>AudioFocusHelper</span><span
class=Arial><span >类的实例。比如：</span></span></p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 8.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:21.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>if</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>android</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>os</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>Build</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>VERSION</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>SDK_INT </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>&gt;=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#006666'>8</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>)</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>{</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
mAudioFocusHelper </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>=</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>new</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#660066'>AudioFocusHelper</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>(</span><span style='font-family:"Calibri","sans-serif";
color:black'>getApplicationContext</span><span style='font-family:
"Calibri","sans-serif";color:#666600'>(),</span><span
style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>this</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>);</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>}</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>else</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>{</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
mAudioFocusHelper </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>=</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>null</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>;</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>}</span></p>

</div>

<p class=MsoNormal align=left style='text-align:left'><b><span
style='font-family:"Calibri","sans-serif";color:#3A3A3A'>&nbsp;</span></b></p>
<p class=MsoNormal align=left style='text-align:left'><a name=cleanup><b><span
>进行清理</span></b></a></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
class=Arial><span >前面提到过，对象可能会消耗相当多的系统资源，因此应该按需保持其运行并在用完后及时调用</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html#release()"><span
style='color:#006699'>release()</span></a></span><span class=Arial><span
>。请显式地调用这个清理方法而不要依赖于系统的垃圾回收机制，这点非常重要。因为等到垃圾回收器回收</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>时可能已经过去相当长的时间了，回收器是只对内存需求敏感的，而对其他媒体相关的资源短缺是不做判断的。因此，在使用服务的时候，应该总是覆盖</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/app/Service.html#onDestroy()"><span
style='color:#006699'>onDestroy()</span></a></span><span class=Arial><span
>方法，以确保释放</span></span><span style='font-family:
"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>：</span></span></p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 8.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:21.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>public</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>class</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>MyService</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>extends</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>Service</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>{</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>MediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> mMediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#880000'>// ...</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#006666'>@Override</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>public</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>void</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> onDestroy</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>()</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>{</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp;</span><span style='font-family:"Calibri","sans-serif";
color:#000088'>if</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>(</span><span style='font-family:"Calibri","sans-serif";
color:black'>mMediaPlayer </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>!=</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>null</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>)</span><span style='font-family:"Calibri","sans-serif";
color:black'> mMediaPlayer</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>release</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>();</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>}</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>}</span></p>

</div>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
class=Arial><span >除了在关闭时释放掉之外，还应该总是寻找其它合适的机会来释放</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span style='font-family:
宋体;color:#007000'>。</span><span class=Arial><span >例如，当预计到较长时间内无法播放媒体时（比如失去</span></span><span
class=Arial><span style='font-family:"Calibri","sans-serif"'>audio
focus</span></span><span class=Arial><span >后），应该明确地释放已有的</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>并稍后再重新创建。另一方面，如果只是想停止播放一会儿，则应该保持住</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>，以避免创建和再次准备的开销。</span></span></p>
<p class=MsoNormal align=left style='text-align:left'><span
style='font-family:"Calibri","sans-serif";color:#333333'>&nbsp;</span></p>
<p class=MsoNormal align=left style='text-align:left'><span
style='font-family:"Calibri","sans-serif";color:#333333'>&nbsp;</span></p>
<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:12.0pt;'>对意图</span></b><b><span
style='font-size:12.0pt;font-family:"Calibri","sans-serif"'>AUDIO_BECOMING_NOISY</span></b><b><span
style='font-size:12.0pt;'>的处理</span></b></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
>在事件到来时，很多编码优秀的音频播放程序都会自动停止播放，因为事件会让音频输出产生噪音（通过外部扬声器播放出来）。比如，用户用耳机听音乐时突然把耳机从设备上拔出来，就可能会产生噪音。不过好在这种现象不会自动发生。如果不实现暂停播放，声音就会从外部扬声器中传出，这可能是用户不愿意听到的。</span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
>这种场合下，可以通过处理</span><span style='font-family:
"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/AudioManager.html#ACTION_AUDIO_BECOMING_NOISY"><span
style='color:#006699'>ACTION_AUDIO_BECOMING_NOISY</span></a></span><span
>意图来确保应用程序停止播放音乐，在</span><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>manifest</span></span><span
class=Arial><span >中加入以下代码，可以</span></span><span
>注册一个处理意图的接收器：</span></p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 8.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:21.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>&lt;receiver</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#882288'>android:name</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#008800'>&quot;.MusicIntentReceiver&quot;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>&gt;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>&lt;intent-filter&gt;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>&lt;action</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#882288'>android:name</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>=</span><span style='font-family:"Calibri","sans-serif";
color:#008800'>&quot;android.media.AUDIO_BECOMING_NOISY&quot;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>/&gt;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>&lt;/intent-filter&gt;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>&lt;/receiver&gt;</span></p>

</div>

<p class=MsoNormal align=left style='text-align:left'><span class=Arial><span
>以下代码注册了</span></span><span style='font-family:
"Calibri","sans-serif";color:#007000'>MusicIntentReceiver</span><span
class=Arial><span >类，用作该意图的广播接收器：</span></span></p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 8.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:21.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>public</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>class</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>MusicIntentReceiver</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>implements</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> android</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>content</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>BroadcastReceiver</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>{</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#006666'>@Override</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>public</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>void</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> onReceive</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>Context</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> ctx</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>,</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>Intent</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> intent</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>)</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>{</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>if</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>(</span><span style='font-family:"Calibri","sans-serif";
color:black'>intent</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>getAction</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>().</span><span style='font-family:"Calibri","sans-serif";
color:black'>equals</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>(</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; android</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>media</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>AudioManager</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>ACTION_AUDIO_BECOMING_NOISY</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>))</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>{</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#880000'>// </span><span style=';color:#880000'>通知服务来停止播放</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#880000'>// </span><span style=';color:#880000'>（比如通过一个意图）</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>}</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>}</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>}</span></p>

</div>

<p class=MsoNormal align=left style='text-align:left'><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>&nbsp;</span></span></p>
<p class=MsoNormal align=left style='text-align:left'><span class=Arial><span
lang=EN-US style='font-family:"Calibri","sans-serif"'>&nbsp;</span></span></p>
<p class=MsoNormal align=center style='text-align:center'><span class=Arial><b><span
style='font-size:12.0pt;'>从</span></b></span><span class=Arial><b><span
lang=EN-US style='font-size:12.0pt;font-family:"Calibri","sans-serif"'>Content
Resolver</span></b></span><span class=Arial><b><span style='font-size:12.0pt;
'>中读取媒体</span></b></span></p>
<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><span
class=Arial><span >媒体播放程序中另一个可能有用的功能就是从用户设备上读取音乐。通过查询外部媒体的</span></span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/content/ContentResolver.html"><span
style='color:#006699'>ContentResolver</span></a></span><span class=Arial><span
>可以实现这一点：</span></span></p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 8.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:21.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>ContentResolver</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>
contentResolver </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>=</span><span style='font-family:"Calibri","sans-serif";
color:black'> getContentResolver</span><span style='font-family:
"Calibri","sans-serif";color:#666600'>();</span><span
style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>Uri</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> uri </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> android</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>provider</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>MediaStore</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>Audio</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>Media</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>EXTERNAL_CONTENT_URI</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>Cursor</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> cursor </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>
contentResolver</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>query</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>(</span><span style='font-family:"Calibri","sans-serif";
color:black'>uri</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>,</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>null</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>,</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>null</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>,</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>null</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>,</span><span style='font-family:"Calibri","sans-serif";
color:black'> </span><span style='font-family:"Calibri","sans-serif";
color:#000088'>null</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>);</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>if</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>cursor </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>==</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>null</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>)</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>{</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#880000'>//
</span><span style=';color:#880000'>查询失败，处理错误。</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>}</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>else</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>if</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(!</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>cursor</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>moveToFirst</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>())</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>{</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#880000'>//</span><span
style=';color:#880000'>设备上不存在媒体文件</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>}</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>else</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>{</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#000088'>int</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> titleColumn </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> cursor</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>getColumnIndex</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>android</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>provider</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>MediaStore</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>Audio</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>Media</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>TITLE</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>);</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#000088'>int</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> idColumn </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> cursor</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>getColumnIndex</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>android</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>provider</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>MediaStore</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>Audio</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>Media</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>_ID</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>);</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#000088'>do</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>{</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp;</span><span style='font-family:"Calibri","sans-serif";
color:#000088'>long</span><span style='font-family:"Calibri","sans-serif";
color:black'> thisId </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>=</span><span style='font-family:"Calibri","sans-serif";
color:black'> cursor</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>getLong</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>(</span><span style='font-family:"Calibri","sans-serif";
color:black'>idColumn</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>);</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp;</span><span style='font-family:"Calibri","sans-serif";
color:#660066'>String</span><span style='font-family:"Calibri","sans-serif";
color:black'> thisTitle </span><span style='font-family:"Calibri","sans-serif";
color:#666600'>=</span><span style='font-family:"Calibri","sans-serif";
color:black'> cursor</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>getString</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>(</span><span style='font-family:"Calibri","sans-serif";
color:black'>titleColumn</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>);</span><span style='font-family:"Calibri","sans-serif";
color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp;</span><span style='font-family:"Calibri","sans-serif";
color:#880000'>// ...</span><span style=';color:#880000'>开始处理</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#880000'>...</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
</span><span style='font-family:"Calibri","sans-serif";color:#666600'>}</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>while</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>cursor</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>moveToNext</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>());</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>}</span></p>

</div>

<p class=MsoNormal align=left style='text-align:left'><span class=Arial><span
>按以下步骤与</span></span><span style='font-family:
"Calibri","sans-serif";color:#007000'><a target="_blank" href="http://developer.android.com/reference/android/media/MediaPlayer.html"><span
style='color:#006699'>MediaPlayer</span></a></span><span class=Arial><span
>一起使用：</span></span></p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 8.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:21.0pt;margin-right:0cm'>

<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>long</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> id </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#880000'>/* </span><span
style=';color:#880000'>从某处读取</span><span style='font-family:"Calibri","sans-serif";
color:#880000'> <span>*/</span></span><span
style='font-family:"Calibri","sans-serif";color:#666600'>;</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>Uri</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> contentUri </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>ContentUris</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>withAppendedId</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp; &nbsp;
&nbsp; &nbsp; android</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>provider</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:#660066'>MediaStore</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:#660066'>Audio</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:#660066'>Media</span><span style='font-family:"Calibri","sans-serif";
color:#666600'>.</span><span style='font-family:"Calibri","sans-serif";
color:black'>EXTERNAL_CONTENT_URI</span><span style='font-family:
"Calibri","sans-serif";color:#666600'>,</span><span
style='font-family:"Calibri","sans-serif";color:black'> id</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>);</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>mMediaPlayer </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>=</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#000088'>new</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> </span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>MediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>();</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>mMediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>setAudioStreamType</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#660066'>AudioManager</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>STREAM_MUSIC</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>);</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>mMediaPlayer</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>.</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>setDataSource</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>getApplicationContext</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>(),</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'> contentUri</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#666600'>);</span><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:black'>&nbsp;</span></p>
<p class=MsoNormal align=left style='margin-left:0cm;text-align:left;
layout-grid-mode:char;background:#FAFAFA;border:none;padding:0cm'><span
lang=EN-US style='font-family:"Calibri","sans-serif";color:#880000'>// ...</span><span
style=';color:#880000'>准备并开始播放</span><span
style='font-family:"Calibri","sans-serif";color:#880000'>...</span></p>

</div>

</div>


</body>

</html>
